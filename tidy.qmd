# Tidy Data

We’ll focus on **tidyr**, a package that provides a bunch of tools to help tidy up messy datasets. **tidyr** is a member of the core tidyverse.

``` r
library(tidyverse)
```

There are two main **advantages** of tidy data:

-   There’s a general advantage to picking one consistent way of storing data. If you have a consistent data structure, it’s easier to learn the tools that work with it because they have an underlying uniformity.

-   There’s a specific advantage to placing variables in columns because it allows R’s vectorized nature to shine.

## Pivot Data

You’ll begin by figuring out what the underlying **variables and observations** are. Sometimes this is easy; other times you’ll need to consult with the people who originally generated the data. Next, you’ll **pivot** your data into a tidy form, with variables in the columns and observations in the rows.

**tidyr** provides two functions for pivoting data: `pivot_longer()` and `pivot_wider()`. We’ll first start with pivot_longer() because it’s the most common case. Let’s dive into some examples.

### `pivot_longer()`: Lengthening Data

Lengthening data means increasing the number of rows and decreasing the number of columns. The inverse transformation is `pivot_wider()`.

In this dataset, each observation is a song. The first three columns (`artist`, `track` and `date.entered`) are variables that describe the song. Then we have 76 columns (`wk1-wk76`) that describe the rank of the song in each week1. Here, the column names are one variable (the `week`) and the cell values are another (the `rank`).

```{r}
tidyr::billboard
```

To tidy this data, we’ll use `pivot_longer()`:

``` {r}
tidyr::billboard |> 
  tidyr::pivot_longer(
    cols = starts_with("wk"), 
    names_to = "week", 
    values_to = "rank",
    values_drop_na = TRUE # to get rid of NAs
  )
```
    
This data is now tidy, but we could make future computation a bit easier by converting values of week from character strings to numbers using `mutate()` and `readr::parse_number()`. `parse_number()` is a handy function that will extract the first number from a string, ignoring all other text.

``` {r}
billboard_longer <- tidyr::billboard |> 
  tidyr::pivot_longer(
    cols = starts_with("wk"), 
    names_to = "week", 
    values_to = "rank",
    values_drop_na = TRUE
  ) |> 
  dplyr::mutate(
    week = readr::parse_number(week)
  )
billboard_longer
```
    
### `pivot_wider()`: **Widening data**

`pivot_wider()`makes datasets wider by increasing columns and reducing rows and helps when one observation is spread across multiple rows. This seems to arise less commonly, but it does seem to crop up a lot when dealing with governmental data.

``` {r}
tidyr::cms_patient_experience
```